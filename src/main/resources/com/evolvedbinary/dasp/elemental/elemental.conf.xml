<?xml version="1.0" encoding="UTF-8"?>
<exist>

    <db-connection cacheSize="256M" checkMaxCacheSize="true" collectionCache="64M" database="native"
        files="../data" pageSize="4096" nodesBuffer="1000" cacheShrinkThreshold="10000"
        minDiskSpace="1024M" posix-chown-restricted="true" preserve-on-copy="false">

        <startup>
            <triggers>
                <trigger class="org.exist.security.BouncyCastleJceProviderStartupTrigger"/>
                <trigger class="org.exist.protocolhandler.URLStreamHandlerStartupTrigger">
                    <!-- Keeps stream data on disk (temporary files are used for XML documents) -->
                    <parameter name="mode" value="disk"/>

                    <!-- Keep's stream data in memory -->
                    <parameter name="mode" value="memory"/>
                </trigger>
            </triggers>
        </startup>

        <query-pool max-stack-size="64" size="128"/>
        <recovery enabled="yes" group-commit="no" journal-dir="../data" size="100M" sync-on-commit="no" force-restart="no" consistency-check="yes"/>
        <watchdog output-size-limit="1000000" query-timeout="-1"/>
    </db-connection>

    <lock-manager upgrade-check="false" warn-wait-on-read-for-write="false" paths-multi-writer="false">
        <lock-table disabled="false" trace-stack-depth="0"/>
        <document use-path-locks="false"/>
    </lock-manager>

    <repository root="/db/apps"/>

    <binary-manager>
        <cache class="org.exist.util.io.FileFilterInputStreamCache"/>
    </binary-manager>

    <indexer caseSensitive="yes" index-depth="5" preserve-whitespace-mixed-content="no" suppress-whitespace="none">
        <modules/>
        <index/>
    </indexer>

    <scheduler/>

    <parser>
        <xml>
            <features>
                <feature name="http://xml.org/sax/features/external-general-entities" value="false"/>
                <feature name="http://xml.org/sax/features/external-parameter-entities" value="false"/>
                <feature name="http://javax.xml.XMLConstants/feature/secure-processing" value="true"/>
            </features>
        </xml>
        <html-to-xml class="org.codelibs.nekohtml.parsers.SAXParser">
            <properties>
                <property name="http://cyberneko.org/html/properties/names/elems" value="match"/>
                <property name="http://cyberneko.org/html/properties/names/attrs" value="no-change"/>
            </properties>
        </html-to-xml>
    </parser>

    <serializer add-exist-id="none" compress-output="no" omit-xml-declaration="yes" omit-original-xml-declaration="no" output-doctype="yes" enable-xinclude="yes" enable-xsl="no" indent="yes" match-tagging-attributes="no" match-tagging-elements="no"/>

    <transformer class="net.sf.saxon.TransformerFactoryImpl" caching="yes">
        <attribute name="http://saxon.sf.net/feature/version-warning" value="false" type="boolean"/>
    </transformer>

    <validation mode="no">
        <entity-resolver>
            <catalog uri="${WEBAPP_HOME}/WEB-INF/catalog.xml"/>
        </entity-resolver>
    </validation>

    <xquery enable-java-binding="no" disable-deprecated-functions="no" enable-query-rewriting="yes" backwardCompatible="no" enforce-index-use="strict" raise-error-on-failed-retrieval="no">
        
        <builtin-modules>

            <!--
                Core Modules
            -->
            <module uri="http://www.w3.org/2005/xpath-functions/map"  class="org.exist.xquery.functions.map.MapModule"/>
            <module uri="http://www.w3.org/2005/xpath-functions/math" class="org.exist.xquery.functions.math.MathModule"/>
            <module uri="http://www.w3.org/2005/xpath-functions/array" class="org.exist.xquery.functions.array.ArrayModule"/>
            <module uri="http://exist-db.org/xquery/backups" class="org.exist.backup.xquery.BackupModule"/>
            <module uri="http://exist-db.org/xquery/inspection" class="org.exist.xquery.functions.inspect.InspectionModule"/>
            <module uri="http://exist-db.org/xquery/kwic" src="resource:org/exist/xquery/lib/kwic.xql"/>
            <module uri="http://exist-db.org/xquery/request" class="org.exist.xquery.functions.request.RequestModule"/>
            <module uri="http://exist-db.org/xquery/response" class="org.exist.xquery.functions.response.ResponseModule"/>
            <module uri="http://exist-db.org/xquery/securitymanager" class="org.exist.xquery.functions.securitymanager.SecurityManagerModule"/>
            <module uri="http://exist-db.org/xquery/session" class="org.exist.xquery.functions.session.SessionModule"/>
            <module uri="http://exist-db.org/xquery/system" class="org.exist.xquery.functions.system.SystemModule"/>
            <module uri="http://exist-db.org/xquery/testing" src="resource:org/exist/xquery/lib/test.xq"/>
            <module uri="http://exist-db.org/xquery/transform" class="org.exist.xquery.functions.transform.TransformModule"/>
            <module uri="http://exist-db.org/xquery/util" class="org.exist.xquery.functions.util.UtilModule">
                <!-- set to true to disable the util:eval functions -->
                <parameter name="evalDisabled" value="false"/>
            </module>
            <module uri="http://exist-db.org/xquery/validation" class="org.exist.xquery.functions.validation.ValidationModule"/>
            <module uri="http://exist-db.org/xquery/xmldb" class="org.exist.xquery.functions.xmldb.XMLDBModule">
                <!-- set to false to disable the use of xs:anyURI as a $contents value for xmldb:store and xmldb:store-as-binary function -->
                <parameter name="allowAnyUri" value="false"/>
            </module>
        </builtin-modules>
    </xquery>

    <xupdate allowed-fragmentation="50000" enable-consistency-checks="no"/>

    <saxon configuration-file="saxon-config.xml"/>

    <rpc-server>
        <content-file in-memory-size="4194304"/>
        <content-file-pool size="10" max-idle="5"/>
    </rpc-server>
</exist>
